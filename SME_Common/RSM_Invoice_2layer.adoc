= 共通EDI 日本版コアインボイス（2階層 RSM） - Invoice 定義
:toc: left
:sectnums:
:lang: ja



== モデル方針（2階層：ヘッダ／明細）
* 3階層（Agreement/Delivery/Settlement）を統合し、**Document（ヘッダ）**と**Line（明細）**に簡素化（CCBDAのACCを2層で表現）。
* VAT は **ヘッダ**で一括計算（JP-PINT 整合）。行は `Rate_Applicable.Percent` の表示のみで税額計算禁止。
* 非VAT（源泉・印紙・自動車重量税 等）は **Allowance/Charge**（`ChargeIndicator` ±、`Category=O`）。

== 1. ヘッダ（Document）
[cols="25,25,25,25",options="header"]
|===
| label_csv | 説明 | UN/CEFACT XPath | JP-PINT XPath

| nan |  |  | nan
| 取引ID |  |  | nan
| 処理日時 |  |  | nan
| nan |  |  | IBG-02
| 取引プロセスID |  |  | IBT-023
| nan |  |  | nan
| nan |  |  | nan
| 取引プロセスバージョンID |  |  | IBT-024
| nan |  |  | nan
| nan |  |  | nan
| nan |  |  | nan
| nan |  |  | nan
| nan |  |  | nan
| nan |  |  | nan
| nan |  |  | nan
| nan |  |  | nan
| nan |  |  | nan
| nan |  |  | nan
| nan |  |  | nan
| nan |  |  | nan
| nan |  |  | nan
| nan |  |  | nan
| 文書ID |  |  | IBT-001
| 文書名 |  |  | nan
| 文書タイプコード |  |  | IBT-003
| 文書発行日 |  |  | IBT-002
| 文書言語ID |  |  | nan
| 文書目的コード |  |  | nan
| 文書履歴ID |  |  | nan
| 文書類型コード |  |  | nan
| 文書サブタイプコード |  |  | nan
| 文書注釈 |  |  | nan
| 文書注釈表題 |  |  | nan
| 文書注釈内容 |  |  | IBT-022
| 文書注釈ID |  |  | nan
| 参照インボイス |  |  | IBG-03
| 参照インボイスID |  |  | IBT-025
| 参照インボイス発行日 |  |  | IBT-026
| 参照インボイス参照タイプコード |  |  | nan
| 参照文書 |  |  | IBG-03
| 参照文書ID |  |  | IBT-025
| 参照文書URL_ID |  |  | IBT-124
| 参照文書発行日 |  |  | IBT-026
| 参照文書参照タイプコード |  |  | nan
| 参照文書履歴ID |  |  | nan
| 参照文書情報 |  |  | IBT-123
| 参照文書タイプコード |  |  | nan
| 添付バイナリファイル |  |  | IBT-125
| 添付バイナリファイルID |  |  | nan
| 添付バイナリファイル名 |  |  | IBT-125-2
| 添付バイナリファイルURI ID |  |  | nan
| 添付バイナリファイルのMIMEコード |  |  | IBT-125-1
| 添付バイナリファイルの説明文 |  |  | nan
| nan |  |  | nan
| nan |  |  | nan
| nan |  |  | nan
| 受注者 |  |  | IBG-04
| 発注者 |  |  | IBG-07
| プロジェクト |  |  | nan
| nan |  |  | nan
|===


== 2. 明細（Line）
[cols="25,25,25,25",options="header"]
|===
| label_csv | 説明 | UN/CEFACT XPath | JP-PINT XPath

| 受注者住所1 |  |  | IBT-035
| 受注者住所2 |  |  | IBT-036
| 受注者住所3 |  |  | IBT-162
| 発注者住所1 |  |  | IBT-050
| 発注者住所2 |  |  | IBT-051
| 発注者住所3 |  |  | IBT-163
| 請求者住所1 |  |  | nan
| 請求者住所2 |  |  | nan
| 請求者住所3 |  |  | nan
| 請求先住所1 |  |  | nan
| 請求先住所2 |  |  | nan
| 請求先住所3 |  |  | nan
| 支払先住所1 |  |  | nan
| 支払先住所2 |  |  | nan
| 支払先住所3 |  |  | nan
| 支払人住所1 |  |  | nan
| 支払人住所2 |  |  | nan
| 支払人住所3 |  |  | nan
| 文書課税分類税額 |  |  | nan
| 文書参照受注書ID |  |  | IBT-014
| 文書参照受注書URL_ID |  |  | nan
| 文書参照受注書発行日 |  |  | nan
| 文書参照受注書履歴ID |  |  | nan
| 文書参照注文書ID |  |  | IBT-013
| 文書参照注文書URL_ID |  |  | nan
| 文書参照注文書発行日 |  |  | nan
| 文書参照注文書履歴ID |  |  | nan
| 文書参照契約書ID |  |  | IBT-012
| 文書参照契約書URL_ID |  |  | nan
| 文書参照契約書発行日 |  |  | nan
| 文書参照契約書履歴ID |  |  | nan
| 納入先ID |  |  | nan
| 納入先国際企業ID |  |  | IBT-071
| 納入先名称 |  |  | IBT-070
| 納入先郵便番号 |  |  | IBT-078
| 納入先住所1 |  |  | IBT-075
| 納入先住所2 |  |  | IBT-076
| 納入先住所3 |  |  | IBT-165
| 納入先国ID |  |  | IBT-080
| 配送日 |  |  | IBT-072
| 受領日 |  |  | nan
| 文書参照出荷案内書ID |  |  | IBT-016
| 文書参照出荷案内書URL_ID |  |  | nan
| 文書参照出荷案内書発行日 |  |  | nan
| 文書参照出荷案内書履歴ID |  |  | nan
| 文書参照出荷案内書文書タイプコード |  |  | nan
| 文書参照出荷案内書文書類型コード |  |  | nan
| 文書参照出荷案内書文書サブタイプコード |  |  | nan
| 文書参照受領報告書ID |  |  | IBT-015
| 文書参照受領報告書URL_ID |  |  | nan
| 文書参照受領報告書発行日 |  |  | nan
| 文書参照受領報告書履歴ID |  |  | nan
| 文書参照受領報告書文書タイプコード |  |  | nan
| 文書参照受領報告書文書サブタイプコード |  |  | nan
| 文書取引方向コード |  |  | nan
| 文書課税分類税額 |  |  | IBT-117
| 文書税タイプコード |  |  | nan
| 文書税率 |  |  | IBT-119
| 文書課税分類課税対象合計金額（税抜き税込み） |  |  | IBT-116
| 文書課税分類コード |  |  | IBT-118
| 文書課税分類税通貨コード |  |  | nan
| 文書課税分類名 |  |  | nan
| 文書課税分類総合計金額 |  |  | nan
| 文書税計算方式 |  |  | nan
| 文書適用税制ID |  |  | nan
| （日本円）文書課税分類税額通貨コード |  |  | nan
| 文書返金 |  |  | IBG-21
| 文書返金判別子 |  |  | nan
| 文書返金計算率 |  |  | IBT-094
| 文書返金金額 |  |  | IBT-092
| 文書返金理由コード |  |  | IBT-098
| 文書返金理由 |  |  | IBT-097
| 文書返金計算根拠金額 |  |  | IBT-093
| 文書ヘッダ返金税タイプコード |  |  | nan
| 文書返金課税分類コード |  |  | IBT-096
| 文書返金税率 |  |  | IBT-095
| 文書追加請求 |  |  | IBG-21
| 文書追加請求合計金額 |  |  | IBT-108
| 文書返金合計金額 |  |  | IBT-107
| 文書消費税合計額 |  |  | IBT-110
|===


== 付録 A：計算・検証ルール（抜粋）
* `GrandTotal = TaxBasisTotal + Σ VAT`（VATはヘッダで計算）
* `DuePayable = GrandTotal + Σ Charges − Σ Allowances − Prepaid ± Rounding`
* 非VATは `CI_Trade_Tax` に含めない（`AllowanceCharge` を用いる）。
